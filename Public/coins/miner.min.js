function scanhash(t,e,r){var n=t.midstate,o=t.data,i=t.hash1,a=t.target,s=void 0===t.t?0:t.t,u=void 0===t.nonce?0:t.nonce,h=0;if(run&&!(u>4294967295))for(;run;){o[3]=u,sha256.reset();for(var d=sha256.update(n,o).state,f=i,l=0;l<8;l++)f[l]=d[l];if(sha256.reset(),is_golden_hash(sha256.update(f).state,a)){t.nonce=u;for(var c=[],l=0;l<t.half.length;l++)c.push(t.half[l]);for(l=0;l<t.data.length;l++)c.push(t.data[l]);var _=derMiner.Util.toPoolString(c);r(_),t.golden_ticket=null}if(u>=maxNonce){r(null);break}if(TotalHashes++,u++,s<(new Date).getTime()&&(s=(new Date).getTime()+reportPeriod,e()),useTimeout&&++h>maxCnt){h=0,t.nonce=u,t.t=s;return void window.setTimeout(function(){scanhash(t,e,r)},1)}}}function is_golden_hash(t,e){if(0==t[7]){var r=derMiner.Util.ToUInt32(t[6]),n=derMiner.Util.ToUInt32(e[6]);return console.log("worker: checking "+r+" <= "+n),r<=n}return!1}function sendProgressUpdate(t){t.total_hashes=TotalHashes,postMessage(t),TotalHashes=0}if(Sha256=function(t,e){var r=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],n=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],o=function(t,e){var r=(65535&t)+(65535&e);return(65535&(t>>16)+(e>>16)+(r>>16))<<16|65535&r},i=function(){for(var t=arguments[0],e=1;e<arguments.length;e++)t=o(t,arguments[e]);return t},a=function(t,e){for(var r=0;r<8;r++)t[r]=e[r]},s=function(t,e){for(r=0;r<16;r++)t[r]=e[r];e=t;for(var r=16;r<64;r++){var n=u(e[r-15],7)^u(e[r-15],18)^h(e[r-15],3),o=u(e[r-2],17)^u(e[r-2],19)^h(e[r-2],10);e[r]=i(e[r-16],n,e[r-7],o)}return e},u=function(t,e){return t>>>e|t<<32-e},h=function(t,e){return t>>>e};this.state=[0,0,0,0,0,0,0,0],a(this.state,n),this.work=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.hex=function(){return derMiner.Util.uint32_array_to_hex(this.state)},this.reset=function(){return a(this.state,n),this},this.update=function(t,e){e||(e=t,t=null),"string"==typeof t&&(t=derMiner.Util.hex_to_uint32_array(t)),t&&a(this.state,t),"string"==typeof e&&(e=derMiner.Util.hex_to_uint32_array(e));for(var n=s(this.work,e),h=this.state,d=h[0],f=h[1],l=h[2],c=h[3],_=h[4],g=h[5],v=h[6],U=h[7],M=0;M<64;M++){var p=u(d,2)^u(d,13)^u(d,22),y=o(p,d&f^d&l^f&l),x=u(_,6)^u(_,11)^u(_,25),m=i(U,x,_&g^~_&v,r[M],n[M]);U=v,v=g,g=_,_=o(c,m),c=l,l=f,f=d,d=o(m,y)}return h[0]=o(h[0],d),h[1]=o(h[1],f),h[2]=o(h[2],l),h[3]=o(h[3],c),h[4]=o(h[4],_),h[5]=o(h[5],g),h[6]=o(h[6],v),h[7]=o(h[7],U),this},t&&this.update(t,e)},sha256=new Sha256,void 0===derMiner)var derMiner={};derMiner.Util={hex_to_uint32_array:function(t){for(var e=[],r=0,n=t.length;r<n;r+=8)e.push(parseInt(t.substring(r,r+8),16));return e},uint32_array_to_hex:function(t){for(var e="",r=0;r<t.length;r++)e+=derMiner.Util.byte_to_hex(t[r]>>>24),e+=derMiner.Util.byte_to_hex(t[r]>>>16),e+=derMiner.Util.byte_to_hex(t[r]>>>8),e+=derMiner.Util.byte_to_hex(t[r]);return e},byte_to_hex:function(t){var e="0123456789abcdef";return t&=255,e.charAt(t/16)+e.charAt(t%16)},reverseBytesInWord:function(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255},reverseBytesInWords:function(t){for(var e=[],r=0;r<t.length;r++)e.push(derMiner.Util.reverseBytesInWord(t[r]));return e},fromPoolString:function(t){return derMiner.Util.reverseBytesInWords(derMiner.Util.hex_to_uint32_array(t))},toPoolString:function(t){return derMiner.Util.uint32_array_to_hex(derMiner.Util.reverseBytesInWords(t))},ToUInt32:function(t){return t>>>0}};var console={log:function(t){postMessage({golden_ticket:!1,print:t})}},TotalHashes=0,useTimeout=!1,reportPeriod=1e3,maxNonce=4294967295,maxCnt=5,run=!0;onmessage=function(t){if(!t.data||!t.data.run)return run=!1,void console.log("worker: forced quit!");var e=t.data;e.golden_ticket=!1,sendProgressUpdate(e);scanhash(t.data,function(){sendProgressUpdate(e)},function(t){e.golden_ticket=t,postMessage(e)})};
